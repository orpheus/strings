# API Docs

## Threads

### POST /v1/threads

#### Rules

1. Posting empty body results in error, missing `name`
2. `name` required field (`name` is not unique in db (different versions share same name))
3. `deleted`, `archived`, `version`, and `dateCreated` are client-immutable fields (only server can change)
4. `id` will always be generated by server

#### Workflows and requirements

1. Create new thread
   1. supply `name`
      1. `id` will be ignored
      2. if `threadId` supplied
         1. if thread exists, will update existing thread (see 2)
         2. if thread not exists, `threadId` be used as the server's `threadId`
      3. if `threadId` not supplied
         1. server will generate one
2. Update existing thread
   1. supply `threadId`
      1. `id` will be ignored
      2. if thread not exists, will create new thread (see 1)
      3. if thread exists, will update existing thread
3. Delete thread
   1. call `/*/thread/delete/:id`

#### Cases

##### Detecting object change

1. if the same request payload is POSTd multiple times, want to prevent unnecessary object version creations
2. need to check if content is same/diff
   1. hash only relevant CONTENT, not metadata
      1. `name`
      2. `strings`
         1. same applies for strings, want to ignore metadata content

Solution

Idea 1

Run a diff compare on each object where it checks only the relevant content

1. Get thread and all strings from database
   1. get latest core.Thread object and compare to POSTd core.Thread object
2. Each thread/string object has a .compare() method which reads in only relevant content data
3. Run through each string running .compare(), updating each one that diffs
4. Diff the thread and update if needed
5. If any string diffs, bump thread

#### Examples

```bash
// A. POST Request -- create initial thread
{
  "id": "A",
  "threadID": "A1",
  "name": "Apple",
  "version": 1
}
// A. POST Response -- thread response
{
  "id": "A",
  "threadID": "A1",
  "name": "Apple",
  "version": 1
}

// B. POST Request -- change name but not id
{
  "id": "A",
  "threadID": "A1",
  "name": "Apple 2",
  "version": 1
}

// B. POST Response -- version bump and id changed
{
  "id": "B",
  "threadID": "A1",
  "name": "Apple 2",
  "version": 2
}

// C. POST Request -- old id, version, but same name
{
  "id": "A",
  "threadID": "A1",
  "name": "Apple 2",
  "version": 1
}

// C. POST Response -- return same object if no change, else version bump and id change
{
  "id": "B",
  "threadID": "A1",
  "name": "Apple 2",
  "version": 2
}
```
